# Лабораторная работа №1 по интеллектуальным системам

## Задача 1. Запросики

### 1. Пекарни "Булочные Ф. Вольчека" в Центральном районе
```overpassql
[out:json];
area["name"="Санкт-Петербург"]->.spb;
area["name"="Центральный район"]->.central;
(
  node(area.central)["name"="Булочные Ф. Вольчека"];
);
out center;
```

### 2. Жилые многоквартирные дома и школы на Васильевском острове
```overpassql
[out:json];
area["name"="Санкт-Петербург"]->.spb;
area["name"="Василеостровский район"]->.vasileostrovsky;
(
  node(area.vasileostrovsky)["building"="apartments"];
  way(area.vasileostrovsky)["building"="apartments"];
  relation(area.vasileostrovsky)["building"="apartments"];
  node(area.vasileostrovsky)["amenity"="school"];
  way(area.vasileostrovsky)["amenity"="school"];
  relation(area.vasileostrovsky)["amenity"="school"];
);
out center;
```
### 3. Книжные магазины в радиусе 500 м от любой станции красной линии метро
```overpassql
[out:json];
area["name"="Санкт-Петербург"]->.spb;
(
  node(area.spb)["station"="subway"]["colour"="red"];
  way(area.spb)["station"="subway"]["colour"="red"];
  relation(area.spb)["station"="subway"]["colour"="red"];
)->.red_metro;
(
  node(around.red_metro:500)["shop"="books"];
  way(around.red_metro:500)["shop"="books"];
  relation(around.red_metro:500)["shop"="books"];
);
out center;
```
### 4. Банкоматы Сбера на Невском проспекте рядом с аптеками
```overpassql
[out:json];
area["name"="Санкт-Петербург"]->.spb;
(
  way["name"="Невский проспект"](area.spb);
)->.nevsky;
(
  node(around.nevsky:100)["amenity"="atm"]["operator"="Сбербанк"];
)->.atms;
node(around.atms:100)["amenity"="pharmacy"];
.atms out center;
```
### 5. Автобусные маршруты около Исаакиевского собора
```overpassql
[out:json];
area["name"="Санкт-Петербург"]->.spb;
(
  node(area.spb)["name"="Исаакиевский собор"];
  way(area.spb)["name"="Исаакиевский собор"];
  relation(area.spb)["name"="Исаакиевский собор"];
)->.cathedral;
(
  node(around.cathedral:500)["highway"="bus_stop"];
  way(around.cathedral:500)["highway"="bus_stop"];
  relation(around.cathedral:500)["highway"="bus_stop"];
)->.stops;
rel(bn.stops)["type"="route"]["route"="bus"];
out geom;
```

## Задача 2. Найти пересечения

### Реализация
```см. task2.py :)```

### резы тестирования
```commandline
улица Мира и улица Чапаева
Точки пересечения найдены:
(59.9627498, 30.3302793)

Рыбацкая улица и улица Ленина
Пересечений не найдено

Невский проспект и набережная реки Фонтанки
Точки пересечения найдены:
(59.9332271, 30.3440136)
(59.9333871, 30.342743)
(59.9331127, 30.3439467)
(59.9332754, 30.3426587)

Садовая улица и Гороховая улица
Точки пересечения найдены:
(59.9285016, 30.3220511)
(59.9285521, 30.3218786)
(59.9285761, 30.3219357)
(59.9284686, 30.3219714)

Вознесенский проспект и переулок Гривцова
Пересечений не найдено

```

## Задача 3. Понять, где ДТП 
### 1. Краткое описание используемых методов решения задачи / технологий и мотивации их выбора
Мы выбрали следовать инструкции из ТЗ, т.е:
1. Составили газетир
   1. Зачем: 
   2. Что использовали (тн технологии)
      1. Overpass API - веб-сервис для получения данных из OpenStreetMap  
      2. Python библиотека `overpass` - обертка для удобной работы с Overpass API
      3. Overpass QL - язык запросов для формулирования запросов к API
   3. Мотивация
      1. Overpass API - инструмент для доступа к данным OSM (OpenStreetMap ツ)
         1. OSM это БД географических объектов по всему миру
         2. OSM опенсорсится: открытый доступ +интернет-сообщество ее поддерживает
         3. Географический объект: 
            1. **точка (node)**: описание точечного объекта или составной элемент пути; 
            2. **путь (way)**: упорядоченный набор точек (не менее 2-х) для описания линейного объекта (улица, забор, река); 
            3. **отношение (relation)**: коллекция элементов (точек, путей и других отношений).
      2. Нам рекомендовали использовать эти технологии. Мы выбрали наименьший путь сопротивления
      3. Как итог: круто, доступно, поддерживаемо, облагорожено либами
2. Нормализовали данные (rta_texts.json)
   1. Зачем: стандартизация - круто
   2. Что использовали (тн технологии):
      1. pymorphy3 - приведение всех слов текста к их нормальным формам с учетом контекста
      2. regex - удаление пунктуации из текста для предобработки
   3. Мотивация:
      1. Слова могут быть в разных падежах => надо привести к именительному (как в базе знаний OSM)
      2. Итог: нормализация позволяет привести упоминания к единой форме, это повысит точность сопоставления с объектами газетира
3. Анализ пространственных отношений и поиск пересечений

### Структура проекта к 3 таске

*   `main.py`: основной скрипт для анализа текстов и извлечения координат
*   `builder.py`: скрипт для сборки газетира (`spb_gazetteer.json`) из OSM
*   `extractor.py`, `gazetteer.py`, `structures.py`: вспомогательные модули с основной логикой
*   `requirements.txt`: файл с необходимыми для работы библиотеками
*   `spb_gazetteer.json`: собсна газетир (генерится с помощью `builder.py`)
*   `rta_texts.json`: тестовые данные с текстами о ДТП и координатами
*   `test_results.json`: файл, в который сохраняются результаты тестирования
